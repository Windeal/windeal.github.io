<!--processed for each article-->
<!DOCTYPE html>
<html lang="zh">
<head>
    <title>ioctl 获取网络接口信息 - Windeal's Home</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!--上述3个meta标签**必须**放在前面，任何其他内容都**必须**跟随其后-->

        <meta name="author" content="Windeal.Li" />
        <meta name="keywords" content="ioctl,Unix,Linux" />
        <meta name="description" content="网络程序（尤其是服务器程序）经常在程序启动后使用ioctl后去所在主机的全部网络接口想你系。包括：接口地址、是否支持广播、是否支持多播等。本文主要介绍ioctl的一些基本知识，以及如何使用ioctl获取网络接口信&gt; ioctl是用来操纵特殊文件的底层设备参数。我们看下ioctl的用法:" />

    <!-- Bootstrap -->
		<!-- Bootstrap core CSS -->
        <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css"/>
		<!-- Bootstrap theme -->
		<link href="/theme/css/bootstrap-theme.min.css" rel="stylesheet">

	<!--百度统计-->
<!--百度统计-->

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?ebe135bbd1292a4b3b8d4a0b3406c42a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
	<!--百度站长平台-->
	<meta name="baidu-site-verification" content="GYyFYVIoFx" />
	

</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <a href="/" class="navbar-brand">
Windeal's Home            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/">我的博客</a></li>
                    <li><a href="/categories.html">分类目录</a></li>
                    <li><a href="/pages/aboutme.html">关于博主</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav> <!-- /.navbar -->


<div class="container theme=showcase" role='main' style="margin-top:50px;">
    <div class="row">
		<div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/ioctl-huo-qu-wang-luo-jie-kou-xin-xi.html"
                       rel="bookmark"
                       title="Permalink to ioctl 获取网络接口信息">
                        ioctl 获取网络接口信息
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <p>网络程序（尤其是服务器程序）经常在程序启动后使用ioctl后去所在主机的全部网络接口想你系。包括：接口地址、是否支持广播、是否支持多播等。本文主要介绍ioctl的一些基本知识，以及如何使用ioctl获取网络接口信息。
　　ioctl是用来操纵特殊文件的底层设备参数。我们看下ioctl的用法:</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;sys/ioctl.h&gt;</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">ioctl</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">request</span><span class="p">,</span> <span class="p">...</span><span class="cm">/* void *arg */</span><span class="p">);</span>
</pre></div>


<ul>
<li><strong>fd：</strong>一个打开的文件描述符。</li>
<li><strong>request：</strong>与设备相关的请求码</li>
<li><strong>arg: </strong> 总是一个指针，指针类型依赖于request参数。该参数其实是ioctl调用需要的数据，或这返回的数据。</li>
<li><strong>返回值:</strong> 一般情况下，返回0标识调用成功，返回-1表失败（并设置errno）。 也有一些操作在成功时返回非负数（该非负数可能携带程序需要的特殊信息）</li>
</ul>
<p>ioctl的request可以分为<strong>套接字，文件，网络接口，ARP，路由，流</strong>六大类，本文主要介绍<strong>网络接口</strong>相关的ioctl操作。
　　我们先来看下ioctl调用中与网络接口相关的request：</p>
<table>
<thead>
<tr>
<th>requets</th>
<th>说明</th>
<th>数据类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>SIOCGIFCONF</td>
<td>获取所有网络接口列表</td>
<td>struct ifconf</td>
</tr>
<tr>
<td>SIOCSIFADDR</td>
<td>设置网络接口地址</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCGIFADDR</td>
<td>获取网络接口地址</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCSIFFLAG</td>
<td>设置接口标志</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCGIFFLAG</td>
<td>获取接口标志</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCSIFDSTADDR</td>
<td>设置点对点地址</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCGIFDSTADDR</td>
<td>获取点对点地址</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCSIFBRDADDR</td>
<td>设置广播地址</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCGIFBRDADDR</td>
<td>获取广播地址</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCSIFNETMASK</td>
<td>设置子网掩码</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCGIFNETMASK</td>
<td>获取子网掩码</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCSIFMETRIC</td>
<td>设置接口的测度</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCGIFMETRIC</td>
<td>获取接口的测度</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCGIFMTU</td>
<td>获取接口 MTU</td>
<td>struct ifreq</td>
</tr>
<tr>
<td>SIOCxxx</td>
<td>其他request，与实现有关</td>
<td>struct ifreq</td>
</tr>
</tbody>
</table>
<p>ioctl操作网络接口无非就是两种情况，要么从内核获取网络接口信息，要么想内核设置网络接口参数。</p>
<h3>ioctl 获取/设置特定网络接口参数</h3>
<p>在前面的request表格中，我们看到，SIOCGIFCONF的数据类型与其他request不同，它是用来获取的所有网络接口列表，具体后面会介绍。现在我们来看下除了SIOCGIFCONF外，其他Request的使用，也就是具体某个网络接口参数的获取与设置。
　　首先，了解下数据类型，即结构体<code>struct ifreq</code></p>
<div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">ifreq</span>
<span class="p">{</span>
<span class="cp"># define IFHWADDRLEN    6</span>
<span class="cp"># define IFNAMSIZ   IF_NAMESIZE</span>
    <span class="k">union</span>
    <span class="p">{</span>
<span class="kt">char</span> <span class="n">ifrn_name</span><span class="p">[</span><span class="n">IFNAMSIZ</span><span class="p">];</span>   <span class="cm">/* Interface name, e.g. &quot;en0&quot;.  */</span>

    <span class="p">}</span> <span class="n">ifr_ifrn</span><span class="p">;</span>

    <span class="k">union</span>
    <span class="p">{</span>
    <span class="k">struct</span> <span class="n">sockaddr</span> <span class="n">ifru_addr</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sockaddr</span> <span class="n">ifru_dstaddr</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sockaddr</span> <span class="n">ifru_broadaddr</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sockaddr</span> <span class="n">ifru_netmask</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sockaddr</span> <span class="n">ifru_hwaddr</span><span class="p">;</span>
    <span class="kt">short</span> <span class="kt">int</span> <span class="n">ifru_flags</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">ifru_ivalue</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">ifru_mtu</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">ifmap</span> <span class="n">ifru_map</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">ifru_slave</span><span class="p">[</span><span class="n">IFNAMSIZ</span><span class="p">];</span>  <span class="cm">/* Just fits the size */</span>
    <span class="kt">char</span> <span class="n">ifru_newname</span><span class="p">[</span><span class="n">IFNAMSIZ</span><span class="p">];</span>
    <span class="n">__caddr_t</span> <span class="n">ifru_data</span><span class="p">;</span>

    <span class="p">}</span> <span class="n">ifr_ifru</span><span class="p">;</span>

<span class="p">};</span>
</pre></div>


<p>不难看出，其实<code>struct ifreq</code>主要包含两个union结构，第一个字段标识网络接口名字，第二个字段则是该网络接口对应具体某个网络参数。简单的说，<strong>一个struct ifreq实例，表示某一网络接口的某个特定网络参数</strong>。现在，我们以网络接口mtu为例，说明我们是如何获得某个网络接口参数的。
　　当我要获取一个网络接口（假设为eth0）的mtu，我们需要一个<code>struct ifreq</code>结构体对象，它的第一个字段的ifrn_name就是eth0了，而第二个union中生效的是int ifr_mtu这一字段。接下来我们看下实际程序中如何获取网络接口mtu。</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;                                                                                                                                                                                           </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;net/if.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/ioctl.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">sock</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">ifreq</span> <span class="n">ifReq</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span>  <span class="p">)</span>
    <span class="p">{</span>  
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;socket failed!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
     <span class="p">}</span>  

    <span class="c1">// 获取eth0 当前MTU</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ifReq</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ifReq</span><span class="p">));</span>
    <span class="n">strncpy</span><span class="p">(</span><span class="n">ifReq</span><span class="p">.</span><span class="n">ifr_ifrn</span><span class="p">.</span><span class="n">ifrn_name</span><span class="p">,</span> <span class="s">&quot;eth0&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">SIOCGIFMTU</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifReq</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>  
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;ioctl SIOCGIFMTU error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
     <span class="p">}</span>  
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;eth0&#39;s mtu is %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ifReq</span><span class="p">.</span><span class="n">ifr_ifru</span><span class="p">.</span><span class="n">ifru_mtu</span><span class="p">);</span>

    <span class="c1">//将eth0的MTU设置为1200</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ifReq</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ifReq</span><span class="p">));</span>
    <span class="n">strncpy</span><span class="p">(</span><span class="n">ifReq</span><span class="p">.</span><span class="n">ifr_ifrn</span><span class="p">.</span><span class="n">ifrn_name</span><span class="p">,</span> <span class="s">&quot;eth0&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="n">ifReq</span><span class="p">.</span><span class="n">ifr_ifru</span><span class="p">.</span><span class="n">ifru_mtu</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">SIOCSIFMTU</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifReq</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>  
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;ioctl  SIOCSIFMTU error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
     <span class="p">}</span>  

    <span class="c1">// 获取eth0 修改 后MTU</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ifReq</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ifReq</span><span class="p">));</span>
    <span class="n">strncpy</span><span class="p">(</span><span class="n">ifReq</span><span class="p">.</span><span class="n">ifr_ifrn</span><span class="p">.</span><span class="n">ifrn_name</span><span class="p">,</span> <span class="s">&quot;eth0&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">SIOCGIFMTU</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifReq</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&quot;ioctl SIOCGIFMTU error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;eth0&#39;s mtu is %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ifReq</span><span class="p">.</span><span class="n">ifr_ifru</span><span class="p">.</span><span class="n">ifru_mtu</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>    
</pre></div>


<p>运行结果：</p>
<div class="highlight"><pre><span></span>windeal@ubuntu:Windeal$ sudo ./a.out
eth0<span class="s1">&#39;s mtu is 1500</span>
<span class="s1">eth0&#39;</span>s mtu is <span class="m">1200</span>
</pre></div>


<h3>ioctl获取所有网络接口列表</h3>
<p>前面我们已经说过，在与网络接口相关的request中，SIOCIFCONF与众不同，它可以获取所有网络接口的列表，SIOCGIFCONF最终返回的其实是一个struct ifreq类型的数组。数组的每一项代表这一个网络接口以及它对应的ip地址。
　　我们先看下<code>struct ifconf</code></p>
<div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">ifconf</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">ifc_len</span><span class="p">;</span>            <span class="cm">/* Size of buffer.  */</span>
    <span class="k">union</span>
      <span class="p">{</span>  
        <span class="kt">char</span><span class="o">*</span> <span class="n">ifcu_buf</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">ifreq</span> <span class="o">*</span><span class="n">ifcu_req</span><span class="p">;</span>
       <span class="p">}</span> <span class="n">ifc_ifcu</span><span class="p">;</span>

<span class="p">};</span>
<span class="cp"># define ifc_buf    ifc_ifcu.ifcu_buf   </span><span class="cm">/* Buffer address.  */</span><span class="cp"></span>
<span class="cp"># define ifc_req    ifc_ifcu.ifcu_req   </span><span class="cm">/* Array of structures.  */</span><span class="cp"></span>
</pre></div>


<p>结构体struct ifconf包含两个字段，第一个字段ifc_len表示第二个字段指向的数据buf的size。第二个字段是一个联合体。
+ <strong>ifc_len：</strong>    数据区的大小
+ <strong>ifcu_buf：</strong>   用户用户设置接口参数时，保存要传给内核的接口参数。
+ <strong>ifcu_req：</strong>    用于用户向内核请求数据，从内核返回的接口信息。
　　<strong>ifcu_req指向一个struct ifreq数组，数组的每一项存储着一个接口的名字和接口的ip。 因此，<code>ifc_len/sizeof(struct ifreq)</code>就是本机的网络接口的数目。</strong>
　</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;                                                                                                                                                                                        </span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;net/if.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/ioctl.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/socket.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;netinet/in.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;arpa/inet.h&gt;</span><span class="cp"></span>
<span class="cp">#define MAX_IF_NUM 10  </span><span class="c1">//假设本机最多10个网络接口</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span> 
    <span class="kt">int</span> <span class="n">sock</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">ipDotBuf</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>  <span class="c1">//保存点分十进制地址</span>
    <span class="k">struct</span> <span class="n">ifreq</span> <span class="n">ifVec</span><span class="p">[</span><span class="n">MAX_IF_NUM</span><span class="p">];</span>
    <span class="k">struct</span> <span class="n">ifconf</span> <span class="n">ifConf</span><span class="p">;</span>
    <span class="n">ifConf</span><span class="p">.</span><span class="n">ifc_len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ifVec</span><span class="p">);</span>
    <span class="n">ifConf</span><span class="p">.</span><span class="n">ifc_buf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">ifVec</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Len: %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ifConf</span><span class="p">.</span><span class="n">ifc_len</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span>  <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;socket failed!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

    <span class="p">}</span>  
    <span class="c1">//获取所有网络接口列表</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">SIOCGIFCONF</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifConf</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;ioctl SIOCGIFCONF failed!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
            <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Len: %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ifConf</span><span class="p">.</span><span class="n">ifc_len</span><span class="p">);</span> 

    <span class="k">struct</span> <span class="n">ifreq</span> <span class="o">*</span><span class="n">ifPt</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">ifreq</span> <span class="o">*</span><span class="n">ifEndPt</span><span class="p">;</span> 
    <span class="n">ifPt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ifreq</span><span class="o">*</span><span class="p">)</span><span class="n">ifVec</span><span class="p">;</span> 
    <span class="n">ifEndPt</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">ifVec</span> <span class="o">+</span> <span class="n">ifConf</span><span class="p">.</span><span class="n">ifc_len</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ifPt</span> <span class="o">=</span> <span class="n">ifVec</span><span class="p">;</span> <span class="n">ifPt</span> <span class="o">&lt;</span> <span class="n">ifEndPt</span><span class="p">;</span> <span class="n">ifPt</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>  
        <span class="k">struct</span> <span class="n">ifreq</span> <span class="n">ifReq</span><span class="p">;</span> 
        <span class="k">if</span> <span class="p">(</span> <span class="n">ifPt</span><span class="o">-&gt;</span><span class="n">ifr_addr</span><span class="p">.</span><span class="n">sa_family</span> <span class="o">!=</span> <span class="n">AF_INET</span>  <span class="p">)</span>  
                <span class="k">continue</span><span class="p">;</span>

        <span class="cm">/*  打印ip地址  */</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">inet_ntoa</span><span class="p">(((</span><span class="k">struct</span> <span class="n">sockaddr_in</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">ifPt</span><span class="o">-&gt;</span><span class="n">ifr_addr</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">sin_addr</span><span class="p">));</span>
     <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 <span class="p">}</span>  
</pre></div>


<p>结果如下</p>
<div class="highlight"><pre><span></span>windeal@ubuntu:Windeal$ ./a.out
Len: 320
Len: 64
127.0.0.1
192.168.1.106
</pre></div>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>
	
<!--邻居导航-->
<section>
 <ul>
     <li> 上一篇：
         <a href="/wu-xian-maczheng-xiang-jie.html">
             无线MAC帧详解
         </a>
     </li>
     <li> 下一篇：
         <a href="/unregister_netdevice-waiting-for-eth1-to-become-freecuo-wu.html">
             unregister_netdevice: waiting for eth1 to become free？错误
         </a>
     </li>
</ul>
</section>
   <!--页面主题内容-->
        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div>

<section>
<h2>最新文章</h2>
<ul id="recent_posts">
  <li class="post">
	  <a href="/gccsheng-ji-dao-jian-dan-fang-fa.html">gcc升级到简单方法</a>
  </li>
  <li class="post">
	  <a href="/unregister_netdevice-waiting-for-eth1-to-become-freecuo-wu.html">unregister_netdevice: waiting for eth1 to become free？错误</a>
  </li>
  <li class="post">
	  <a href="/ioctl-huo-qu-wang-luo-jie-kou-xin-xi.html">ioctl 获取网络接口信息</a>
  </li>
  <li class="post">
	  <a href="/wu-xian-maczheng-xiang-jie.html">无线MAC帧详解</a>
  </li>
</ul>
</section><!--相关文章-->

<section>
	<h2>相关文章</h2>
    <ul id="related_posts">
        <li class="posts">
			<a href="/unregister_netdevice-waiting-for-eth1-to-become-freecuo-wu.html">unregister_netdevice: waiting for eth1 to become free？错误</a>
		</li>
    </ul>
</section>


</div>            </aside>
        </div>
    </div>

<!--页面底部-->

<footer class='footer' style="margin-top:100px">
  <p>
		Copyright &copy;  2015&ndash;2017  Windeal
  </p>
</footer></div>

	<!--百度站长平台-->
<!--百度站长-->
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
	<script src="/theme/js/bootstrap.js"></script>
	<script src="/theme/js/bootstrap.min.js"></script>
	<script src="/theme/js/npm.js"></script>

</body>
</html>
