<!--processed for each article-->
<!DOCTYPE html>
<html lang="zh">
<head>
    <title>无线MAC帧详解 - Windeal's Home</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!--上述3个meta标签**必须**放在前面，任何其他内容都**必须**跟随其后-->

        <meta name="author" content="Windeal.Li" />
        <meta name="keywords" content="wireless,MAC" />
        <meta name="description" content="Mac帧由三个基本域组成 Mac Header Frame Body FCS Frame Ctrl Frame 含2Byte（16位），可以进一步分为以下子字段：" />

    <!-- Bootstrap -->
		<!-- Bootstrap core CSS -->
        <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css"/>
		<!-- Bootstrap theme -->
		<link href="/theme/css/bootstrap-theme.min.css" rel="stylesheet">

	<!--百度统计-->
<!--百度统计-->

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?ebe135bbd1292a4b3b8d4a0b3406c42a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
	<!--百度站长平台-->
	<meta name="baidu-site-verification" content="GYyFYVIoFx" />
	

</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <a href="/" class="navbar-brand">
Windeal's Home            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/">我的博客</a></li>
                    <li><a href="/categories.html">分类目录</a></li>
                    <li><a href="/pages/aboutme.html">关于博主</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav> <!-- /.navbar -->


<div class="container theme=showcase" role='main' style="margin-top:50px;">
    <div class="row">
		<div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/wu-xian-maczheng-xiang-jie.html"
                       rel="bookmark"
                       title="Permalink to 无线MAC帧详解">
                        无线MAC帧详解
                    </a>
                </h1>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Windeal.Li
    </span>
  </span>
  <time datetime="2015-11-05T00:00:00+08:00" pubdate>
	  Thu 05 November 2015
  </time>
  <span class="categories"><a class='category' href='/category/tcpip.html'>tcpip</a>
  </span>
  <span class="categories">
    <a class="category" href="/tag/wireless.html">wireless</a>,    <a class="category" href="/tag/mac.html">MAC</a>  </span>
</p>            </header>
            <div class="entry-content">
                <p>[TOC]</p>
<h1>802.11 MAC帧（无线MAC帧）</h1>
<p><img alt="Paste_Image.png" src="/static/images/TCPIP/wirelessMacFrame01.png"></p>
<p>Mac帧由三个基本域组成：</p>
<ul>
<li><strong>Mac Header：</strong>包括帧控制（ Frame Control） 、 时长（ Duration） 、 地址（ Address） 等</li>
<li><strong>Frame Body：</strong>代表数据域。 这部分内容的长度可变， 其具体存储的内容由帧类型（ type） 和子类型（ sub type） 决定。</li>
<li><strong>FCS：</strong>    （ Frame Check Sequence， 帧校验序列） 用于保障帧数据完整性。
　　我们主要关注Mac Header部门，我们来逐个分析下Mac Header中的字段</li>
</ul>
<h3>Frame Ctrl</h3>
<p>Frame 含2Byte（16位），可以进一步分为以下子字段：</p>
<p><strong>(1) Protocol Version：</strong>
　　代表802.11 MAC帧的版本号。 目前的值是0。</p>
<p><strong>(2) Type和Subtype: </strong>
　　Type字段有00，01，10，11四种取值，将802.11中MAC帧分别划分为control、 data和management三种类型（Type=11保留）。
　　Type与Subtype结合可以802.11MAC帧细分为以下类型（不全）。（本文后面对各个子类型进一步介绍）</p>
<table>
<thead>
<tr>
<th align="center">Type（b3b2)</th>
<th align="center">类型描述</th>
<th align="center">Subtype(b7-b4)</th>
<th align="center">子类型描述</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">00</td>
<td align="center">Management</td>
<td align="center">0000/1</td>
<td align="center">Association Request/Response</td>
</tr>
<tr>
<td align="center">00</td>
<td align="center">Management</td>
<td align="center">0100/1</td>
<td align="center">Probe  Request/Response</td>
</tr>
<tr>
<td align="center">00</td>
<td align="center">Management</td>
<td align="center">1000</td>
<td align="center">Beacon帧</td>
</tr>
<tr>
<td align="center">00</td>
<td align="center">Management</td>
<td align="center">1101</td>
<td align="center">Action帧</td>
</tr>
<tr>
<td align="center">01</td>
<td align="center">Control</td>
<td align="center">1010</td>
<td align="center">PS-POLL帧，（省电轮询）</td>
</tr>
<tr>
<td align="center">01</td>
<td align="center">Control</td>
<td align="center">1011</td>
<td align="center">RTS</td>
</tr>
<tr>
<td align="center">01</td>
<td align="center">Control</td>
<td align="center">1100</td>
<td align="center">CTS</td>
</tr>
<tr>
<td align="center">01</td>
<td align="center">Control</td>
<td align="center">1101</td>
<td align="center">ACK</td>
</tr>
<tr>
<td align="center">01</td>
<td align="center">Data</td>
<td align="center">0000</td>
<td align="center">Data</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">保留</td>
<td align="center">0000-1111</td>
<td align="center">保留</td>
</tr>
</tbody>
</table>
<p><strong>(4)To DS 和 From DS: </strong>
　　只用在数据类型的帧中。DS即Distribution System。 From DS和To Ds分别表明数据帧是否来自或去往DS。（这里的来自和去往分别对应最初的源地址，和最终的目的地址。如STA经DS发往另一个STA，则该帧既不来自DS，也不去往S，而是STA和STA之间的通信。）</p>
<table>
<thead>
<tr>
<th>To DS</th>
<th>From DS</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>即不来自DS也不去往DS, 即STA与STA之间的通信。也可能是管理帧或控制帧。</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>表明该帧有DS 发往非DS， 一般是AP发给STA</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>表明该帧由非DS发往DS，一般是STA发给AP</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>该帧来自DS，又去往DS，其实就是只带AP与AP之间的数据帧</td>
</tr>
</tbody>
</table>
<p><strong>(6) More Fragments: </strong>
　　表明数据是否分片。 只支持data和management帧类型。</p>
<p><strong>(7) Retry: </strong>
　　如果该值为1， 表明是重传包。</p>
<p><strong>(8) Power Management: </strong>
　　表明发送该帧的STA处于活跃模式还是处于省电模式。</p>
<p><strong>(9) More Data: </strong>
　　和省电模式有关。 AP会为那些处于省电模式下的STA缓冲一些数据帧， 而STA会定时查询是否有数据要接收。 该参数表示AP中还有缓冲的数据帧。 如果该值为0， 表明STA已经接收完数据帧了（ 下节将介绍省电模式相关的内容） 。</p>
<p><strong>(10): Protected Frame: </strong>
　　表明数据是否加密。</p>
<p><strong>(11): Order: </strong>
　　 指明接收端必须按顺序处理该帧。</p>
<h3>Duration/ID</h3>
<p>Duration/ID域占2字节共16位， 其具体含义根据Type和Subtype的不同而变化， 不过大体就两种， 分别代表ID和Duration。</p>
<h3>Address (Address1~Address4)</h3>
<p>首先，我们要知道，这里的Address以Mac地址的形式表示。网络传输中，Mac地址需要考虑字节序。Mac地址，字节序为Big-endian， 即最高字节在前。比特序为Little-endian， 即最低位在前。
　　802.11 MAC帧头部分共包含四个Address域（一个可选）， 但规范中却有五种地址定义， 分别如下：</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>地址定义</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>BSSID</td>
<td>在基础型BSS中， 它为AP① 的地址。 而在IBSS中则是一个本地唯一MAC地址。</td>
</tr>
<tr>
<td>2</td>
<td>目标地址    DA</td>
<td>MAC帧的最终目的地址 ， 可以是单播或组播地址。</td>
</tr>
<tr>
<td>3</td>
<td>源地址        SA</td>
<td>MAC帧的最初源地址，  一般情况下都是单播地址。</td>
</tr>
<tr>
<td>4</td>
<td>发送STA地址：TA</td>
<td>一次经WM（无限媒介）传输的发送端地址，类似于路由中某一跳的起点</td>
</tr>
<tr>
<td>5</td>
<td>接收STA地址：RA</td>
<td>一次经WM（无限媒介）传输的接收端地址，类似于路由中某一跳的终点</td>
</tr>
</tbody>
</table>
<p>下面我们看下MAC首部4个地址域 与 规范中5中地址的对应关系：</p>
<table>
<thead>
<tr>
<th>To DS</th>
<th>From Ds</th>
<th>网络类型</th>
<th>Adress 1（接收端）</th>
<th>Address 2 （发送端）</th>
<th>Address 3</th>
<th>Address 4</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>IBSS</td>
<td>DA = RA</td>
<td>TA = SA</td>
<td>BSSID</td>
<td>未使用</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td>From AP</td>
<td>DA = RA</td>
<td>TA = BSSID</td>
<td>SA</td>
<td>未使用</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td>To AP</td>
<td>RA = BSSID</td>
<td>TA = SA</td>
<td>DA</td>
<td>未使用</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>AP to AP</td>
<td>RA</td>
<td>TA</td>
<td>DA</td>
<td>SA</td>
</tr>
</tbody>
</table>
<h3>SeqCtrl</h3>
<p>此字段用来丢弃重复帧和重复分片。包含两个子字段：Fragment Number 和Sequence Number。</p>
<ul>
<li><strong>Fragment Number：</strong>用于分片帧</li>
<li><strong>Sequence Number：</strong>用于检验重复帧。如果设备收到的MAC帧的Sequence Number与之前收到的帧重复则丢弃。</li>
</ul>
<h3>Qos Ctrl(可选)</h3>
<p>此字段只出现在数据帧中，用以实现802.11e无限Qos功能。</p>
<h3>HT Control(可选)</h3>
<p>用于控制802.11n的“High-throughput”</p>
<h3>Frame Body</h3>
<p>代表数据域。 这部分内容的长度可变， 其具体存储的内容由帧类型（ type） 和子类型（subtype） 决定。</p>
<h3>FCS</h3>
<p>Frame Check Sequence， 帧校验序列， 用于保障帧数据完整性。</p>
<h2>帧类型</h2>
<p>前面在介绍Type和SubType字段的时候，我们已经知道这两个字段将无线MAC帧分为不同的类型，现在我们来进一步介绍下不同的无线MAC帧</p>
<h3>数据帧</h3>
<p>负责传送数据报文</p>
<table>
<thead>
<tr>
<th>帧类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Data</td>
<td>货真价实的数据帧， 802.11数据报文的承载体</td>
</tr>
<tr>
<td>NULL</td>
<td>只有802.11 MAC首部 和FCS字段 在802.11中，Station可以通过NULL通知基站自己省电模式的改变</td>
</tr>
</tbody>
</table>
<h3>控制帧</h3>
<p>控制帧主要用来协助数据帧的传输，负责无线区域的清空，信道的获取等，还用于收取数据时的确认。下面是几种常用的控制帧。</p>
<table>
<thead>
<tr>
<th>帧类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>RTS/CTS</td>
<td>负责无限信道的清空，取得媒介控制权</td>
</tr>
<tr>
<td>PS-Poll</td>
<td>当Station从省电模式醒来，可以发送PS-Poll帧，从基站获取缓存帧</td>
</tr>
<tr>
<td>ACK</td>
<td>无线通信接收端通过回应ACK帧，向发送端确认接收到了报文</td>
</tr>
<tr>
<td>Block Ack Request/ Block Ack</td>
<td>802.11n中，为了提升MAC层的效率，使用BlockACK机制对收到的一批数据帧进行一次性确认， Block Ack Request/ Block Ack用来简历BlockACK通道</td>
</tr>
</tbody>
</table>
<h3>管理帧</h3>
<p>负责对无线网络的管理，包括网络信息通告、加入或退出无线网络，频谱管理等。</p>
<table>
<thead>
<tr>
<th>帧类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Beacon</td>
<td>信标帧，周期性宣告某个802.11网络的存在，以及支持各类无线参数，比如网络名称（SSID），支持的速率，认证类型等。也包含基站为进入省电模式的Station缓存帧的信息。　｜</td>
</tr>
<tr>
<td>Association Request/Response</td>
<td>关联请求/应答， 当Station 师徒加入某个802.11网络，Station和基站关联时会使用。</td>
</tr>
<tr>
<td>Disassociation</td>
<td>去关联帧，Station和基站都可以发送Disassociation解除和对方的关联</td>
</tr>
<tr>
<td>Authentication/Deauthentication</td>
<td>认证/去认证帧，Station 和 基站关联是使用，用于无限身份认证</td>
</tr>
<tr>
<td>Probe Request/Response</td>
<td>探测帧， Station后基站 均可以发送该帧探测周围有那些802.11网络。接收到的基站需回应Probe Response， Probe Respoonse 帧中包含了Beacon帧所有的参数</td>
</tr>
<tr>
<td>Action</td>
<td>802.11h标准中添加的帧。用来要求802.11设备才去各类行动进行频谱管理</td>
</tr>
</tbody>
</table>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>
	
<!--邻居导航-->
<section>
 <ul>
     <li> 下一篇：
         <a href="/ioctl-huo-qu-wang-luo-jie-kou-xin-xi.html">
             ioctl 获取网络接口信息
         </a>
     </li>
</ul>
</section>
   <!--页面主题内容-->
        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div>

<section>
<h2>最新文章</h2>
<ul id="recent_posts">
  <li class="post">
	  <a href="/httpszhi-shi-zheng-li-shang.html">HTTPS知识整理(上）</a>
  </li>
  <li class="post">
	  <a href="/http2ru-men.html">HTTP2入门</a>
  </li>
  <li class="post">
	  <a href="/gccsheng-ji-dao-jian-dan-fang-fa.html">gcc升级到简单方法</a>
  </li>
  <li class="post">
	  <a href="/unregister_netdevice-waiting-for-eth1-to-become-freecuo-wu.html">unregister_netdevice: waiting for eth1 to become free？错误</a>
  </li>
  <li class="post">
	  <a href="/ioctl-huo-qu-wang-luo-jie-kou-xin-xi.html">ioctl 获取网络接口信息</a>
  </li>
</ul>
</section><!--相关文章-->

<section>
</section>


</div>            </aside>
        </div>
    </div>

<!--页面底部-->

<footer class='footer' style="margin-top:100px">
  <p>
		Copyright &copy;  2015&ndash;2017  Windeal
  </p>
</footer></div>

	<!--百度站长平台-->
<!--百度站长-->
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
	<script src="/theme/js/bootstrap.js"></script>
	<script src="/theme/js/bootstrap.min.js"></script>
	<script src="/theme/js/npm.js"></script>

</body>
</html>
