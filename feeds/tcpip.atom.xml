<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Windeal's Home - tcpip</title><link href="/" rel="alternate"></link><link href="/feeds/tcpip.atom.xml" rel="self"></link><id>/</id><updated>2015-11-05T00:00:00+08:00</updated><entry><title>无线MAC帧详解</title><link href="/wu-xian-maczheng-xiang-jie.html" rel="alternate"></link><published>2015-11-05T00:00:00+08:00</published><updated>2015-11-05T00:00:00+08:00</updated><author><name>Windeal.Li</name></author><id>tag:None,2015-11-05:/wu-xian-maczheng-xiang-jie.html</id><summary type="html">&lt;p&gt;Mac帧由三个基本域组成 Mac Header Frame Body FCS Frame Ctrl  Frame 含2Byte（16位），可以进一步分为以下子字段：&lt;/p&gt;</summary><content type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1&gt;802.11 MAC帧（无线MAC帧）&lt;/h1&gt;
&lt;p&gt;&lt;img alt="Paste_Image.png" src="/static/images/TCPIP/wirelessMacFrame01.png"&gt;&lt;/p&gt;
&lt;p&gt;Mac帧由三个基本域组成：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Mac Header：&lt;/strong&gt;包括帧控制（ Frame Control） 、 时长（ Duration） 、 地址（ Address） 等&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Frame Body：&lt;/strong&gt;代表数据域。 这部分内容的长度可变， 其具体存储的内容由帧类型（ type） 和子类型（ sub type） 决定。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FCS：&lt;/strong&gt;    （ Frame Check Sequence， 帧校验序列） 用于保障帧数据完整性。
　　我们主要关注Mac Header部门，我们来逐个分析下Mac Header中的字段&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Frame Ctrl&lt;/h3&gt;
&lt;p&gt;Frame 含2Byte（16位），可以进一步分为以下子字段：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(1) Protocol Version：&lt;/strong&gt;
　　代表802.11 MAC帧的版本号。 目前的值是0。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(2) Type和Subtype: &lt;/strong&gt;
　　Type字段有00，01，10，11四种取值，将802.11中MAC帧分别划分为control、 data和management三种类型（Type=11保留）。
　　Type与Subtype结合可以802.11MAC帧细分为以下类型（不全）。（本文后面对各个子类型进一步介绍）&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="center"&gt;Type（b3b2)&lt;/th&gt;
&lt;th align="center"&gt;类型描述&lt;/th&gt;
&lt;th align="center"&gt;Subtype(b7-b4)&lt;/th&gt;
&lt;th align="center"&gt;子类型描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="center"&gt;00&lt;/td&gt;
&lt;td align="center"&gt;Management&lt;/td&gt;
&lt;td align="center"&gt;0000/1&lt;/td&gt;
&lt;td align="center"&gt;Association Request/Response&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;00&lt;/td&gt;
&lt;td align="center"&gt;Management&lt;/td&gt;
&lt;td align="center"&gt;0100/1&lt;/td&gt;
&lt;td align="center"&gt;Probe  Request/Response&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;00&lt;/td&gt;
&lt;td align="center"&gt;Management&lt;/td&gt;
&lt;td align="center"&gt;1000&lt;/td&gt;
&lt;td align="center"&gt;Beacon帧&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;00&lt;/td&gt;
&lt;td align="center"&gt;Management&lt;/td&gt;
&lt;td align="center"&gt;1101&lt;/td&gt;
&lt;td align="center"&gt;Action帧&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;01&lt;/td&gt;
&lt;td align="center"&gt;Control&lt;/td&gt;
&lt;td align="center"&gt;1010&lt;/td&gt;
&lt;td align="center"&gt;PS-POLL帧，（省电轮询）&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;01&lt;/td&gt;
&lt;td align="center"&gt;Control&lt;/td&gt;
&lt;td align="center"&gt;1011&lt;/td&gt;
&lt;td align="center"&gt;RTS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;01&lt;/td&gt;
&lt;td align="center"&gt;Control&lt;/td&gt;
&lt;td align="center"&gt;1100&lt;/td&gt;
&lt;td align="center"&gt;CTS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;01&lt;/td&gt;
&lt;td align="center"&gt;Control&lt;/td&gt;
&lt;td align="center"&gt;1101&lt;/td&gt;
&lt;td align="center"&gt;ACK&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;01&lt;/td&gt;
&lt;td align="center"&gt;Data&lt;/td&gt;
&lt;td align="center"&gt;0000&lt;/td&gt;
&lt;td align="center"&gt;Data&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="center"&gt;11&lt;/td&gt;
&lt;td align="center"&gt;保留&lt;/td&gt;
&lt;td align="center"&gt;0000-1111&lt;/td&gt;
&lt;td align="center"&gt;保留&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;(4)To DS 和 From DS: &lt;/strong&gt;
　　只用在数据类型的帧中。DS即Distribution System。 From DS和To Ds分别表明数据帧是否来自或去往DS。（这里的来自和去往分别对应最初的源地址，和最终的目的地址。如STA经DS发往另一个STA，则该帧既不来自DS，也不去往S，而是STA和STA之间的通信。）&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;To DS&lt;/th&gt;
&lt;th&gt;From DS&lt;/th&gt;
&lt;th&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;即不来自DS也不去往DS, 即STA与STA之间的通信。也可能是管理帧或控制帧。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;表明该帧有DS 发往非DS， 一般是AP发给STA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;表明该帧由非DS发往DS，一般是STA发给AP&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;该帧来自DS，又去往DS，其实就是只带AP与AP之间的数据帧&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;(6) More Fragments: &lt;/strong&gt;
　　表明数据是否分片。 只支持data和management帧类型。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(7) Retry: &lt;/strong&gt;
　　如果该值为1， 表明是重传包。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(8) Power Management: &lt;/strong&gt;
　　表明发送该帧的STA处于活跃模式还是处于省电模式。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(9) More Data: &lt;/strong&gt;
　　和省电模式有关。 AP会为那些处于省电模式下的STA缓冲一些数据帧， 而STA会定时查询是否有数据要接收。 该参数表示AP中还有缓冲的数据帧。 如果该值为0， 表明STA已经接收完数据帧了（ 下节将介绍省电模式相关的内容） 。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(10): Protected Frame: &lt;/strong&gt;
　　表明数据是否加密。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(11): Order: &lt;/strong&gt;
　　 指明接收端必须按顺序处理该帧。&lt;/p&gt;
&lt;h3&gt;Duration/ID&lt;/h3&gt;
&lt;p&gt;Duration/ID域占2字节共16位， 其具体含义根据Type和Subtype的不同而变化， 不过大体就两种， 分别代表ID和Duration。&lt;/p&gt;
&lt;h3&gt;Address (Address1~Address4)&lt;/h3&gt;
&lt;p&gt;首先，我们要知道，这里的Address以Mac地址的形式表示。网络传输中，Mac地址需要考虑字节序。Mac地址，字节序为Big-endian， 即最高字节在前。比特序为Little-endian， 即最低位在前。
　　802.11 MAC帧头部分共包含四个Address域（一个可选）， 但规范中却有五种地址定义， 分别如下：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;序号&lt;/th&gt;
&lt;th&gt;地址定义&lt;/th&gt;
&lt;th&gt;含义&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;BSSID&lt;/td&gt;
&lt;td&gt;在基础型BSS中， 它为AP① 的地址。 而在IBSS中则是一个本地唯一MAC地址。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;目标地址    DA&lt;/td&gt;
&lt;td&gt;MAC帧的最终目的地址 ， 可以是单播或组播地址。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;源地址        SA&lt;/td&gt;
&lt;td&gt;MAC帧的最初源地址，  一般情况下都是单播地址。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;发送STA地址：TA&lt;/td&gt;
&lt;td&gt;一次经WM（无限媒介）传输的发送端地址，类似于路由中某一跳的起点&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;接收STA地址：RA&lt;/td&gt;
&lt;td&gt;一次经WM（无限媒介）传输的接收端地址，类似于路由中某一跳的终点&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;下面我们看下MAC首部4个地址域 与 规范中5中地址的对应关系：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;To DS&lt;/th&gt;
&lt;th&gt;From Ds&lt;/th&gt;
&lt;th&gt;网络类型&lt;/th&gt;
&lt;th&gt;Adress 1（接收端）&lt;/th&gt;
&lt;th&gt;Address 2 （发送端）&lt;/th&gt;
&lt;th&gt;Address 3&lt;/th&gt;
&lt;th&gt;Address 4&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;IBSS&lt;/td&gt;
&lt;td&gt;DA = RA&lt;/td&gt;
&lt;td&gt;TA = SA&lt;/td&gt;
&lt;td&gt;BSSID&lt;/td&gt;
&lt;td&gt;未使用&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;From AP&lt;/td&gt;
&lt;td&gt;DA = RA&lt;/td&gt;
&lt;td&gt;TA = BSSID&lt;/td&gt;
&lt;td&gt;SA&lt;/td&gt;
&lt;td&gt;未使用&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;To AP&lt;/td&gt;
&lt;td&gt;RA = BSSID&lt;/td&gt;
&lt;td&gt;TA = SA&lt;/td&gt;
&lt;td&gt;DA&lt;/td&gt;
&lt;td&gt;未使用&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;AP to AP&lt;/td&gt;
&lt;td&gt;RA&lt;/td&gt;
&lt;td&gt;TA&lt;/td&gt;
&lt;td&gt;DA&lt;/td&gt;
&lt;td&gt;SA&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;SeqCtrl&lt;/h3&gt;
&lt;p&gt;此字段用来丢弃重复帧和重复分片。包含两个子字段：Fragment Number 和Sequence Number。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Fragment Number：&lt;/strong&gt;用于分片帧&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Sequence Number：&lt;/strong&gt;用于检验重复帧。如果设备收到的MAC帧的Sequence Number与之前收到的帧重复则丢弃。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Qos Ctrl(可选)&lt;/h3&gt;
&lt;p&gt;此字段只出现在数据帧中，用以实现802.11e无限Qos功能。&lt;/p&gt;
&lt;h3&gt;HT Control(可选)&lt;/h3&gt;
&lt;p&gt;用于控制802.11n的“High-throughput”&lt;/p&gt;
&lt;h3&gt;Frame Body&lt;/h3&gt;
&lt;p&gt;代表数据域。 这部分内容的长度可变， 其具体存储的内容由帧类型（ type） 和子类型（subtype） 决定。&lt;/p&gt;
&lt;h3&gt;FCS&lt;/h3&gt;
&lt;p&gt;Frame Check Sequence， 帧校验序列， 用于保障帧数据完整性。&lt;/p&gt;
&lt;h2&gt;帧类型&lt;/h2&gt;
&lt;p&gt;前面在介绍Type和SubType字段的时候，我们已经知道这两个字段将无线MAC帧分为不同的类型，现在我们来进一步介绍下不同的无线MAC帧&lt;/p&gt;
&lt;h3&gt;数据帧&lt;/h3&gt;
&lt;p&gt;负责传送数据报文&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;帧类型&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Data&lt;/td&gt;
&lt;td&gt;货真价实的数据帧， 802.11数据报文的承载体&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NULL&lt;/td&gt;
&lt;td&gt;只有802.11 MAC首部 和FCS字段 在802.11中，Station可以通过NULL通知基站自己省电模式的改变&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;控制帧&lt;/h3&gt;
&lt;p&gt;控制帧主要用来协助数据帧的传输，负责无线区域的清空，信道的获取等，还用于收取数据时的确认。下面是几种常用的控制帧。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;帧类型&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;RTS/CTS&lt;/td&gt;
&lt;td&gt;负责无限信道的清空，取得媒介控制权&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PS-Poll&lt;/td&gt;
&lt;td&gt;当Station从省电模式醒来，可以发送PS-Poll帧，从基站获取缓存帧&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ACK&lt;/td&gt;
&lt;td&gt;无线通信接收端通过回应ACK帧，向发送端确认接收到了报文&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Block Ack Request/ Block Ack&lt;/td&gt;
&lt;td&gt;802.11n中，为了提升MAC层的效率，使用BlockACK机制对收到的一批数据帧进行一次性确认， Block Ack Request/ Block Ack用来简历BlockACK通道&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;管理帧&lt;/h3&gt;
&lt;p&gt;负责对无线网络的管理，包括网络信息通告、加入或退出无线网络，频谱管理等。&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;帧类型&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Beacon&lt;/td&gt;
&lt;td&gt;信标帧，周期性宣告某个802.11网络的存在，以及支持各类无线参数，比如网络名称（SSID），支持的速率，认证类型等。也包含基站为进入省电模式的Station缓存帧的信息。　｜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Association Request/Response&lt;/td&gt;
&lt;td&gt;关联请求/应答， 当Station 师徒加入某个802.11网络，Station和基站关联时会使用。&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Disassociation&lt;/td&gt;
&lt;td&gt;去关联帧，Station和基站都可以发送Disassociation解除和对方的关联&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Authentication/Deauthentication&lt;/td&gt;
&lt;td&gt;认证/去认证帧，Station 和 基站关联是使用，用于无限身份认证&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Probe Request/Response&lt;/td&gt;
&lt;td&gt;探测帧， Station后基站 均可以发送该帧探测周围有那些802.11网络。接收到的基站需回应Probe Response， Probe Respoonse 帧中包含了Beacon帧所有的参数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Action&lt;/td&gt;
&lt;td&gt;802.11h标准中添加的帧。用来要求802.11设备才去各类行动进行频谱管理&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</content><category term="wireless"></category><category term="MAC"></category></entry></feed>